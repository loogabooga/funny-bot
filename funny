import cv2
from os import remove
# split funny.mp4 into frames
vidcap = cv2.VideoCapture('funny.mp4')
fps = vidcap.get(cv2.CAP_PROP_FPS)
success,image = vidcap.read()
count = 0
while success:
  cv2.imwrite("frame%d.jpg" % count, image)     # save frame as JPEG file
  success,image = vidcap.read()
  print('Read a new frame: ', success)
  count += 1
# canny edge detection on each frame
for i in range(count):
  img = cv2.imread("frame%d.jpg" % i)
  gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
  edges = cv2.Canny(gray,50,150)
  cv2.imwrite("frame%d.jpg" % i, edges)
# create video from frames
img_array = []
for i in range(count):
    img = cv2.imread("frame%d.jpg" % i)
    img_array.append(img)
    height, width, layers = img.shape
    size = (width,height)
    print(size)
out = cv2.VideoWriter('funny_edges.mp4', cv2.VideoWriter_fourcc('M','P','4','V'), fps, size)
for i in range(len(img_array)):
    out.write(img_array[i])
out.release()

#insert audio from funny.mp4 to funny_edges.mp4 using moviepy
import moviepy.editor as mp
clip = mp.VideoFileClip("funny_edges.mp4")
audio = mp.AudioFileClip("funny.mp4")
final_clip = clip.set_audio(audio)
final_clip.write_videofile("funnier.mp4")

# delete all frames
for i in range(count):
  remove("frame%d.jpg" % i)
remove("funny_edges.mp4")